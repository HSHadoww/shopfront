import{aq as q,X as S,Y as B,Z as k,x as C,A as F,a0 as P,a1 as $,c as a,a3 as o,ar as A,a5 as M,ab as N,an as n,aa as d,V as R,a7 as u,ao as E,ap as T,J as f,a8 as U}from"./index-137ce921.js";import{c as j,e as D,u as I,d as J,V as L}from"./index.esm-aae1b636.js";import{V as O}from"./VContainer-4b3ff42c.js";import{V as X}from"./VRow-1adcc988.js";import{V as m}from"./VCol-0050f0b5.js";const Y={style:{"white-space":"pre"}},Z=n("h1",{class:"text-red text-h1"},"已下架",-1),ee={__name:"ProductView",setup(z){const _=q(),p=S(),{api:g,apiAuth:V}=N(),i=B(),v=k(),t=C({_id:"",name:"",price:0,description:"",image:"",sell:!0,category:""}),y=j({quantity:D().typeError("缺少數量").required("缺少數量").min(1,"數量最小為 1")}),{isSubmitting:h,handleSubmit:b}=I({validationSchema:y,initialValues:{quantity:1}}),c=J("quantity"),x=b(async l=>{var s,e;if(!v.isLogin){p.push("/login");return}try{const{data:r}=await V.patch("/users/cart",{product:t.value._id,quantity:l.quantity});v.cart=r.result,i({text:"新增成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}})}catch(r){const w=((e=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:e.message)||"發生錯誤，請稍後再試";i({text:w,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}});return F(async()=>{var l,s;try{const{data:e}=await g.get("/products/"+_.params.id);t.value._id=e.result._id,t.value.name=e.result.name,t.value.price=e.result.price,t.value.description=e.result.description,t.value.image=e.result.image,t.value.sell=e.result.sell,t.value.category=e.result.category,document.title=`購物網 | ${t.value.name}`}catch(e){const r=((s=(l=e==null?void 0:e.response)==null?void 0:l.data)==null?void 0:s.message)||"發生錯誤，請稍後再試";i({text:r,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}}),p.push("/")}}),(l,s)=>(P(),$(M,null,[a(O,null,{default:o(()=>[a(X,null,{default:o(()=>[a(m,{cols:"12"},{default:o(()=>[n("h1",null,d(t.value.name),1)]),_:1}),a(m,{cols:"12",md:"6"},{default:o(()=>[a(R,{src:t.value.image},null,8,["src"])]),_:1}),a(m,{cols:"12",md:"6"},{default:o(()=>[n("p",null,"$"+d(t.value.price),1),n("p",Y,d(t.value.description),1),a(L,{disabled:u(h),onSubmit:E(u(x),["prevent"])},{default:o(()=>[a(T,{type:"number",min:"0",modelValue:u(c).value.value,"onUpdate:modelValue":s[0]||(s[0]=e=>u(c).value.value=e),"error-messages":u(c).errorMessage.value},null,8,["modelValue","error-messages"]),a(f,{type:"submit","prepend-icon":"mdi-cart"},{default:o(()=>[U("加入購物車")]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1})]),_:1}),a(A,{class:"align-center justify-center text-center","model-value":!t.value.sell,persistent:""},{default:o(()=>[Z,a(f,{to:"/"})]),_:1},8,["model-value"])],64))}};export{ee as default};
